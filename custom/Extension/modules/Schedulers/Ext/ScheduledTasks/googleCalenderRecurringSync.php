<?phpif (!defined('sugarEntry') || !sugarEntry)    die('Not A Valid Entry Point');require_once('custom/include/Google/GoogleHelper.php');require_once("include/utils/encryption_utils.php");require_once('custom/modules/Schedulers/license/OutfittersLicense.php');require_once("modules/Administration/Administration.php");// TODO// $job_strings[] = 'googleCalenderRecurringSync';function googleCalenderRecurringSync(){	require('custom/modules/Schedulers/license/config.php');    if (OutfittersLicense::validateModule()) {        $admin = new Administration();        $admin->retrieveSettings();        if (isset($admin->settings[$outfitters_config['shortname'].'_validated_users']) && $admin->settings[$outfitters_config['shortname'].'_validated_users'] == true) {            $_SESSION['dcheckAlldayFunc'] = 1;			if(GoogleHelper::check_column_if_exist($GLOBALS['sugar_config']['dbconfig']['db_name'],'users', 'enable_gsync')){					$gh                           = new GoogleHelper();				$json                         = getJSONobj();				//increasing limits				set_time_limit(9000);				ini_set('memory_limit', '2048M'); //blacklist while package scan				$sql       = "SELECT 						DISTINCT U.id,U.user_name,U.gmail_id,U.gmail_pass,U.lastsync_calendar					FROM users AS U					WHERE 						U.deleted='0' AND 						U.status='Active' AND U.enable_gsync=1";				$res       = $GLOBALS['db']->query($sql);				$processed = array();				while ($row = $GLOBALS['db']->fetchByAssoc($res)) {					try {												if (!empty($row['gmail_id']) && !empty($row['gmail_pass'])) {							if (in_array(strtolower($row['gmail_id']), $processed)) {								$GLOBALS['log']->fatal("This email (" . $row['gmail_id'] . ") is configured in multiple users settings,skipping....");								continue;							} else {								$processed[] = strtolower($row['gmail_id']);							}							$GLOBALS['log']->fatal('STARTED: calendarRecurring sync: ' . $row['user_name'] . '(' . $row['gmail_id'] . ')');							if (empty($row['lastsync_calendar']) || !isset($row['lastsync_calendar'])) {								$row['lastsync_calendar'] = '2013-01-01 01:01:01';							}							$gh->performSync($row['gmail_id'], blowfishDecode(blowfishGetKey('encrypt_field'), $row['gmail_pass']), $row['id'], $row['lastsync_calendar'], 'calendarRecurring');														$GLOBALS['log']->fatal('COMPLETED: calendarRecurring sync: ' . $row['user_name'] . '(' . $row['gmail_id'] . ')');						}					}					catch (Exception $ex) {						$GLOBALS['log']->fatal('ERROR:' . $ex->getMessage());					}				}				unset($_SESSION['dcheckAlldayFunc']);				return true;			}else{				$GLOBALS['log']->fatal('Gmail Sync failed in CRON run. do quick repair and rebuild first.');				return false;			}        } else {            $GLOBALS['log']->fatal('Gmail Sync failed in CRON run. You enabled more than allowed users for GSync');            return false;        }    } else {        $GLOBALS['log']->fatal('Gmail Sync failed in CRON run. Unable to validate key.');        return false;    }}